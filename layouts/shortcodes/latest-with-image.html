{{/* Shortcode: latest-with-image.html Params: - pages: (optional) slice of
pages; defaults to .Site.RegularPages - count: (optional) number of posts;
defaults to 7 */}} {{ $ctx := . }} {{ $pages := default .Site.RegularPages
($ctx.Get "pages") }} {{ $count := default 7 ($ctx.Get "count") | int }} {{
$posts := first $count (sort $pages "Date" "desc") }}

<div class="latest-with-image-list">
  {{- range $posts }} {{ $p := . }} {{ $rawTag := "" }} {{ $match := findRE
  `(?s)<(?:img|iframe)[^>]*src=\"([^\"]+)\"[^>]*>` $p.Content }} {{ if gt (len
  $match) 0 }} {{ $rawTag = index $match 0 }} {{ else if
  $p.Params.featured_image }} {{ $rawTag = printf `<img src=\"%s\">`
  $p.Params.featured_image }} {{ end }} {{ $summary := replaceRE
  `(?s)<(?:img|iframe)[^>]*>` "" $p.Summary }}

  <article class="latest-item">
    <div class="media-column">
      <a href="{{ $p.RelPermalink }}">
        <div class="media-container">
          {{ if in $rawTag "iframe" }} {{ $src := replaceRE
          `(?s).*src=\"([^\"]+)\".*` `$1` $rawTag }}
          <iframe src="{{ $src }}" frameborder="0" allowfullscreen></iframe>
          {{ else if in $rawTag "<img" }} {{ $src := replaceRE
          `(?s).*src=\"([^\"]+)\".*` `$1` $rawTag }}
          <img src="{{ $src }}" alt="{{ $p.Title }}" />
          {{ else }}
          <div class="media-placeholder"></div>
          {{ end }}
        </div>
      </a>
    </div>
    <div class="text-column">
      <h2 class="post-title">
        <a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
      </h2>
      <p class="post-summary">{{ $summary | safeHTML }}</p>
    </div>
  </article>
  {{- end }}
</div>
