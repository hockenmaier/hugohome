{{ $page := . }}

{{ $basepath := path.Clean (urls.Parse (relLangURL "")).Path }}
{{ $breadcrumbs := $page.Ancestors | and ($page.Param "paige.site.disable_breadcrumbs" | not) }}
{{ $description := $page.Param "paige.description" | markdownify | and ($page.Param "paige.site.disable_description" | not) }}
{{ $first := templates.Exists "partials/paige/site-header-first.html" }}
{{ $last := templates.Exists "partials/paige/site-header-last.html" }}
{{ $links := false }}
{{ $menu := $page.Param "paige.site.disable_menu" | not }}
{{ $pills := false }}
{{ $tabs := false }}
{{ $underline := false }}

{{ $title := $page.Param "paige.title" | default site.Title | markdownify | and ($page.Param "paige.site.disable_title" | not) }}

{{ if eq $basepath "/" }}
  {{ $basepath = "" }}
{{ end }}

{{ $pagepath := strings.TrimPrefix $basepath $page.RelPermalink }}

{{ with $page.Param "paige.menu_style" }}
  {{ if eq . "pills" }}
    {{ $pills = true }}
  {{ else if eq . "tabs" }}
    {{ $tabs = true }}
  {{ else if eq . "underline" }}
    {{ $underline = true }}
  {{ else }}
    {{ $links = true }}
  {{ end }}
{{ else }}
  {{ $links = true }}
{{ end }}

{{ if or $breadcrumbs $description $first $last $menu $title }}
<header id="paige-site-header">

  {{ if $first }}
    {{ partial "paige/site-header-first.html" $page }}
  {{ end }}

  {{ with $title }}
    <div class="display-1 fw-bold {{ if $description }} mb-2 {{ end }} paige-row-wide text-center" id="paige-site-title">{{ . }}</div>
  {{ end }}

  {{ with $description }}
    <div class="lead paige-row-wide text-center" id="paige-site-description">{{ . }}</div>
  {{ end }}

  {{ if $menu }}
    <!-- Custom pill menu: Home, Tags, About Me, dynamic Categories -->
    <nav aria-label="{{ i18n `paige_menu` }}" class="paige-row-wide" id="paige-menu">
      <ul class="align-items-center justify-content-center nav {{ if $pills }} nav-pills {{ else if $tabs }} nav-tabs {{ else if $underline }} nav-underline {{ end }}">
        <li class="nav-item"><a class="nav-link" href="{{ relLangURL "" }}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ "/tags/" | relURL }}">Tags</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ "/about-me/" | relURL }}">About Me</a></li>
        {{ range $name, $_ := site.Taxonomies.categories }}
          <li class="nav-item"><a class="nav-link" href="{{ (printf "/categories/%s/" (urlize $name)) | relURL }}">{{ $name }}</a></li>
        {{ end }}
      </ul>
    </nav>
  {{ end }}

  {{ with $breadcrumbs }}
    <nav aria-label="{{ i18n `paige_breadcrumbs` }}" class="paige-row-wide" id="paige-breadcrumbs">
      <div class="d-flex justify-content-center">
        <ol class="breadcrumb mb-0">
          {{ $reverse := .Reverse }}
          {{ $last := sub (len $reverse) 1 }}
          {{ range $i, $ancestor := $reverse }}
            {{ $title := $ancestor.Title }}
            {{ if and (eq $i $last) (not $title) }}
              {{ $title = $page.Param "paige.title" | default (site.Title) }}
            {{ end }}
            <li class="breadcrumb-item"><a href="{{ .RelPermalink }}">{{ $title | markdownify | plainify | htmlUnescape }}</a></li>
          {{ end }}
        </ol>
      </div>
    </nav>
  {{ end }}

  {{ if $last }}
    {{ partial "paige/site-header-last.html" $page }}
  {{ end }}
</header>
{{ end }}
