{{ $d      := . }}
{{ $p      := $d.page }}
{{ $width  := default 300 $d.width | int }}
{{ $height := default 300 $d.height | int }}

{{/* ── extract first media tag or featured_image ───────────── */}}
{{ $raw := "" }}
{{ $src := "" }}
{{ $m := findRE `(?s)<(?:img|iframe)[^>]*src=\"([^\"]+)\"[^>]*>` $p.Content }}
{{ if gt (len $m) 0 }}
  {{ $raw = index $m 0 }}
  {{ $src = replaceRE `(?s).*src=\"([^\"]+)\".*` `$1` $raw }}
{{ else if $p.Params.featured_image }}
  {{ $raw = printf `<img src=\"%s\">` $p.Params.featured_image }}
  {{ $src = $p.Params.featured_image }}
{{ end }}

{{/* ── clean summary: strip img/iframe tags ───────────────── */}}
{{ $sum := $p.Summary |
    replaceRE `(?s)<iframe[^>]*>.*?</iframe>` `` |
    replaceRE `(?s)<img[^>]*>` `` |
    replaceRE `(?s)<figcaption[^>]*>.*?</figcaption>` `` |
    replaceRE `(?s)<span[^>]*font-style:[^>]*>.*?</span>` `` |
    safeHTML }}

<article class="latest-item mb-4" style="display:flex; align-items:flex-start;">
  <div class="media-column">
    <div class="media-container" style="width:{{ $width }}px;height:{{ $height }}px;">
      {{ if in $src "youtube.com" }}
        {{ $vid := replaceRE `.*(?:embed/|v=)([^?&/]+).*` `$1` $src }}
        <a href="{{ $p.RelPermalink }}">
          <img src="https://img.youtube.com/vi/{{ $vid }}/hqdefault.jpg" alt="{{ $p.Title }}">
        </a>
      {{ else if in $raw "<iframe" }}
        <a href="{{ $p.RelPermalink }}"><div class="media-placeholder"></div></a>
      {{ else if in $raw "<img" }}
        <a href="{{ $p.RelPermalink }}"><img src="{{ $src }}" alt="{{ $p.Title }}"></a>
      {{ else }}
        <a href="{{ $p.RelPermalink }}"><div class="media-placeholder"></div></a>
      {{ end }}
    </div>
  </div>
  <div class="text-column" style="align-self:flex-start; margin-top:0;">
    <h2 class="post-title" style="margin-top:0 !important; margin-bottom:0 !important;">
      <a class="link-light" href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
    </h2>
    <div class="post-summary" style="margin-top:0; margin-bottom:.5rem;">
      {{ $sum }}
    </div>
    <p class="read-more text-secondary fst-italic" style="margin:0;">
      {{ $p.Date.Format "January 2, 2006" }} · {{ $p.ReadingTime }} {{ i18n "paige_minutes" $p.ReadingTime }} ·
      <a href="{{ $p.RelPermalink }}">Read more →</a>
    </p>
  </div>
</article>

