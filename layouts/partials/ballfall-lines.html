<!-- layouts/partials/ballfall-lines.html -->
<script>
  window.addEventListener('BallFallTextReady', function() {
    const {
      engine,
      world
    } = window.BallFall || {};
    if (!engine || !world) return;
  
    const Bodies = Matter.Bodies,
          World  = Matter.World;
  
    let firstClick = null;
  
    function isNonInteractable(target) {
      const clickableTags = ['A','BUTTON','INPUT','TEXTAREA','SELECT','LABEL'];
      return !clickableTags.includes(target.tagName);
    }
  
    document.addEventListener('click', e => {
      if (!isNonInteractable(e.target)) {
        return; 
      }
      if (!firstClick) {
        firstClick = { x: e.pageX, y: e.pageY };
      } else {
        const dx = e.pageX - firstClick.x;
        const dy = e.pageY - firstClick.y;
        const length = Math.sqrt(dx*dx + dy*dy);
        const angle = Math.atan2(dy, dx);
        const midX = (firstClick.x + e.pageX) / 2;
        const midY = (firstClick.y + e.pageY) / 2;
        firstClick = null;
  
        const lineBody = Bodies.rectangle(midX, midY, length, 2, {
          isStatic: true,
          angle: angle,
          render: { visible: false }
        });
        World.add(world, lineBody);
      }
    });
  });
  </script>
  