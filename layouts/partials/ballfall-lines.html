<!-- layouts/partials/ballfall-lines.html -->
<script>
  window.addEventListener('BallFallTextReady', function() {
    const {
      engine,
      world
    } = window.BallFall || {};
    if (!engine || !world) return;
  
    const Bodies = Matter.Bodies,
          World  = Matter.World;
  
    let firstClick = null;
  
    // We skip anchors, buttons, form fields, etc.
    function isNonInteractable(target) {
      const clickableTags = ['A','BUTTON','INPUT','TEXTAREA','SELECT','LABEL'];
      return !clickableTags.includes(target.tagName);
    }
  
    document.addEventListener('click', e => {
      if (!isNonInteractable(e.target)) {
        return;
      }
  
      // Convert from page coords to "engine" coords by subtracting current scroll
      const clickX = e.pageX - window.scrollX;
      const clickY = e.pageY - window.scrollY;
  
      if (!firstClick) {
        firstClick = { x: clickX, y: clickY };
      } else {
        const dx = clickX - firstClick.x;
        const dy = clickY - firstClick.y;
        const length = Math.sqrt(dx*dx + dy*dy);
        const angle = Math.atan2(dy, dx);
        const midX = (firstClick.x + clickX) / 2;
        const midY = (firstClick.y + clickY) / 2;
  
        firstClick = null;
  
        // Create a thin static rectangle rendered in #956eff
        const lineBody = Bodies.rectangle(midX, midY, length, 2, {
          isStatic: true,
          angle: angle,
          render: {
            fillStyle: '#956eff',
            strokeStyle: '#956eff',
            lineWidth: 1
          }
        });
        World.add(world, lineBody);
      }
    });
  });
  </script>
  