{{/* The purpose of this script is to create bounce or roll lines when the user clicks on the screen */}}

<!-- layouts/partials/ballfall-lines.html -->
<script>
  window.addEventListener('BallFallBaseReady', function() {
    const linesList = [];
    const {
      engine,
      world
    } = window.BallFall || {};
    if (!engine || !world) return;
  
    const Bodies = Matter.Bodies,
          World  = Matter.World;
  
    let firstClick = null;
  
    // We skip anchors, buttons, form fields, etc.
    function isNonInteractable(e) {
      // isNonInteractable() should be TRUE when it's a place we want to draw lines
      // and FALSE when we want to skip (like a button)

      // If we find a 'clickable' ancestor, return false
      const clickable = e.target.closest('a, button, input, textarea, select, label');
      return !clickable;
    }

    document.addEventListener('click', (e) => {
      if (!isNonInteractable(e)) {
        // That means we *did* click a button/etc., skip
        return;
      }

    window.BallFall.clearLines = () => {
      linesList.forEach(body => {
        Matter.World.remove(world, body);
      });
      linesList.length = 0;
    };
  
  
      // Convert from page coords to "engine" coords by subtracting current scroll
      const clickX = e.pageX - window.scrollX;
      const clickY = e.pageY - window.scrollY;
  
      if (!firstClick) {
        firstClick = { x: clickX, y: clickY };
      } else {
        const dx = clickX - firstClick.x;
        const dy = clickY - firstClick.y;
        const length = Math.sqrt(dx*dx + dy*dy);
        const angle = Math.atan2(dy, dx);
        const midX = (firstClick.x + clickX) / 2;
        const midY = (firstClick.y + clickY) / 2;
  
        firstClick = null;
  
        // Create a thin static rectangle rendered in #956eff
        const lineBody = Bodies.rectangle(midX, midY, length, 2, {
          isStatic: true,
          angle: angle,
          render: {
            fillStyle: '#956eff',
            strokeStyle: '#956eff',
            lineWidth: 1
          }
        });
        World.add(world, lineBody);
        linesList.push(lineBody);
      }
    });
  });
  </script>
  